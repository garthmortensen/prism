version: 2

sources:
  - name: dagster_runs
    description: Dagster-managed run artifacts (registry + atomic outputs).
    schema: main_runs
    tables:
      - name: run_registry
        description: Run metadata and lineage for Dagster executions.
        columns:
          - name: run_timestamp
            description: Run timestamp key (YYYYMMDDHHMMSSUUUU).
          - name: run_id
            description: UUID for the run.
          - name: group_id
          - name: group_description
          - name: run_description
          - name: analysis_type
          - name: calculator
          - name: model_version
          - name: benefit_year
          - name: data_effective
          - name: json_config
          - name: git_branch
          - name: git_commit
          - name: git_commit_short
          - name: git_commit_clean
          - name: status
          - name: trigger_source
          - name: created_at
          - name: updated_at

  - name: dagster_runs_outputs
    description: Dagster-managed atomic run outputs.
    schema: main_runs
    tables:
      - name: risk_scores
        description: Member-level risk scores output by Dagster.
        columns:
          - name: run_timestamp
          - name: run_id
          - name: member_id
          - name: calculator
          - name: model_version
          - name: benefit_year
          - name: risk_score
          - name: demographic_score
          - name: hcc_score
          - name: rxc_score
          - name: hcc_list
          - name: rxc_list
          - name: details
          - name: created_at


  - name: dagster_analytics
    description: Dagster-managed downstream analytics outputs.
    schema: main_analytics
    tables:
      - name: run_comparison
        description: Member-level deltas between two runs.
        columns:
          - name: batch_id
          - name: run_id_a
          - name: run_id_b
          - name: member_id
          - name: match_status
          - name: score_a
          - name: score_b
          - name: score_diff
          - name: details
          - name: created_at

      - name: decomposition_scenarios
        description: Detailed driver-level impact values for decomposition scenarios.
        columns:
          - name: batch_id
          - name: driver_name
          - name: impact_value
          - name: run_id
          - name: created_at

      - name: decomposition_definitions
        description: Metadata definitions for decomposition drivers.
        columns:
          - name: batch_id
          - name: step_index
          - name: driver_name
          - name: description
          - name: created_at
